# 觀戰模式測試指南

## 🎯 測試目標
驗證4個AI可以自動對戰，觀戰者可以觀看完整遊戲直到分出勝負。

## 📋 測試環境
- **開發伺服器**: http://localhost:5179/
- **啟動狀態**: ✅ 正在運行
- **編譯狀態**: ✅ 無錯誤

## 🧪 測試步驟

### 步驟 1: 進入首頁
1. 打開瀏覽器訪問 `http://localhost:5179/`
2. **檢查點**:
   - [ ] 頁面正常載入
   - [ ] 看到"👁️ 觀看AI對戰"按鈕（紫色漸變）
   - [ ] 按鈕位置正確且樣式美觀

### 步驟 2: 進入觀戰大廳
1. 點擊"👁️ 觀看AI對戰"按鈕
2. **檢查點**:
   - [ ] 成功導航到 `/spectator-lobby`
   - [ ] 看到"配置AI對戰"標題
   - [ ] 看到4個AI玩家配置卡片
   - [ ] 每個AI卡片顯示：
     - [ ] 名稱輸入框（預設：Captain Chen, Sailor Sam, Fisher Finn, Lucky Lucy）
     - [ ] 難度選擇器（預設：Hard, Medium, Medium, Easy）
     - [ ] 顏色指示器（藍/綠/橙/粉）
   - [ ] 遊戲速度選擇器（4個選項）
   - [ ] 選項開關：顯示所有手牌、顯示AI思考
   - [ ] "開始觀戰"按鈕
   - [ ] "返回首頁"按鈕

### 步驟 3: 配置AI（可選）
1. 嘗試修改AI名稱
2. 嘗試切換AI難度
3. 嘗試調整遊戲速度
4. **檢查點**:
   - [ ] 名稱輸入框可編輯
   - [ ] 難度選擇器可切換
   - [ ] 速度選擇器可切換
   - [ ] UI回饋清晰

### 步驟 4: 開始觀戰
1. 點擊"開始觀戰"按鈕
2. **檢查點**:
   - [ ] 成功導航到 `/spectator/{roomId}`
   - [ ] 看到"👁️ 觀戰模式 - AI對戰中"橫幅
   - [ ] 看到4個AI玩家區域（2x2佈局）
   - [ ] 每個AI區域顯示：
     - [ ] AI名稱
     - [ ] 手牌（正面朝上，可見）
     - [ ] 分數
   - [ ] 看到桌面中央區域：
     - [ ] 牌堆
     - [ ] 左側棄牌堆
     - [ ] 右側棄牌堆
   - [ ] 看到控制面板：
     - [ ] 速度按鈕（🐢 Slow / ▶️ Normal / ⏩ Fast / ⚡ Turbo）
     - [ ] ⏸️ 暫停按鈕
     - [ ] 🔄 重新開始按鈕
     - [ ] 🏠 返回大廳按鈕
   - [ ] 看到動作日誌區域

### 步驟 5: 觀看AI對戰
**這是最重要的測試！**

1. **靜觀其變**，不要點擊任何按鈕
2. **觀察AI自動出牌**
3. **檢查點**:

   **✅ AI輪流出牌**
   - [ ] 第一個AI（Captain Chen）開始抽牌
   - [ ] AI自動做出決策（抽牌、配對、宣告等）
   - [ ] 輪到下一個AI（Sailor Sam）
   - [ ] 4個AI循環輪流
   - [ ] 每個AI回合間隔合理（不會太快或太慢）

   **✅ 遊戲進度正常**
   - [ ] AI手牌數量變化正確
   - [ ] 棄牌堆正常更新
   - [ ] 牌堆數量減少
   - [ ] 分數正常累積

   **✅ 當前回合指示明確**
   - [ ] 當前回合的AI有高亮或特殊標記
   - [ ] 可以清楚看出輪到誰

   **✅ 動作日誌更新**
   - [ ] 日誌顯示每個AI的動作
   - [ ] 訊息清晰易懂（例如："Captain Chen 抽了一張牌"）
   - [ ] 日誌自動滾動

   **✅ 特殊情況處理**
   - [ ] AI配對卡牌時，看到配對動畫和效果
   - [ ] AI宣告Stop時，顯示正確訊息
   - [ ] AI觸發特殊卡牌效果（偷牌、換牌等）時處理正確

### 步驟 6: 測試控制功能

**A. 速度控制測試**
1. 遊戲進行中，點擊"⏩ Fast"
2. **檢查**: AI出牌速度明顯加快
3. 點擊"🐢 Slow"
4. **檢查**: AI出牌速度明顯變慢
5. 點擊"⚡ Turbo"
6. **檢查**: AI出牌速度非常快
7. 回到"▶️ Normal"
8. **檢查**: 速度恢復正常

**B. 暫停/繼續測試**
1. 點擊"⏸️ 暫停"按鈕
2. **檢查**:
   - [ ] AI停止出牌
   - [ ] 遊戲凍結
   - [ ] 按鈕變為"▶️ 繼續"
3. 等待5秒
4. **檢查**: 遊戲仍然暫停，沒有自動恢復
5. 點擊"▶️ 繼續"按鈕
6. **檢查**:
   - [ ] AI繼續出牌
   - [ ] 遊戲從暫停處恢復

### 步驟 7: 觀看直到遊戲結束

**耐心等待！讓AI完整跑完一局！**

1. **不要干預**，讓遊戲自然進行
2. **觀察勝利條件**:
   - 某個AI達到目標分數（4人局：30分）
   - 某個AI收集4條美人魚（即時勝利）
3. **檢查點**:

   **✅ 遊戲結束處理**
   - [ ] 遊戲正確判斷勝利者
   - [ ] 顯示"遊戲結束"或類似訊息
   - [ ] 顯示勝利者名稱和分數
   - [ ] AI停止出牌

   **✅ 結算顯示**
   - [ ] 看到最終分數排行
   - [ ] 每個AI的最終分數正確
   - [ ] 勝利者有特殊標記或動畫

   **✅ 重新開始選項**
   - [ ] "重新開始"按鈕可用
   - [ ] 點擊後可以開始新一局

### 步驟 8: 重新開始測試
1. 遊戲結束後，點擊"🔄 重新開始"按鈕
2. **檢查點**:
   - [ ] 遊戲狀態重置
   - [ ] 4個AI重新開始
   - [ ] 牌堆重新洗牌
   - [ ] 分數歸零
   - [ ] AI再次自動對戰

### 步驟 9: 瀏覽器Console檢查
**非常重要！**

1. 按F12打開開發者工具
2. 切換到"Console"標籤
3. **檢查點**:
   - [ ] 沒有紅色錯誤訊息
   - [ ] 沒有黃色警告（或只有無關緊要的警告）
   - [ ] 看到藍色的遊戲日誌（[Spectator] 開頭的訊息）
   - [ ] 日誌顯示AI決策過程

4. **查找關鍵日誌**:
   ```
   [Spectator] Battle loop started for room: XXXX
   [Spectator] Captain Chen (hard) - Phase: draw, Decision: draw
   [Spectator] Sailor Sam (medium) - Phase: pair, Decision: no-pair
   ...
   [Spectator] Game finished
   ```

### 步驟 10: 長時間穩定性測試（可選）
1. 重新開始多局遊戲（至少3局）
2. **檢查點**:
   - [ ] 每局都能正常完成
   - [ ] 沒有記憶體洩漏（瀏覽器不會變慢）
   - [ ] 沒有累積錯誤
   - [ ] Firebase連接穩定

## 🐛 常見問題排查

### 問題1: AI不出牌，遊戲卡住
**可能原因**:
- Firebase連接問題
- 遊戲狀態異常

**排查步驟**:
1. 檢查Console是否有錯誤
2. 檢查網絡標籤，確認Firebase請求正常
3. 嘗試重新整理頁面

### 問題2: AI出牌太快看不清
**解決方案**:
- 點擊"🐢 Slow"按鈕降低速度
- 或點擊"⏸️ 暫停"查看當前狀態

### 問題3: 遊戲結束但沒有顯示勝利者
**可能原因**:
- 勝利判斷邏輯有誤
- UI更新延遲

**排查步驟**:
1. 檢查Console的遊戲狀態日誌
2. 查看Firebase中的gameState

### 問題4: 重新開始後卡住
**可能原因**:
- 舊的battle loop沒有清理

**排查步驟**:
1. 檢查Console是否有錯誤
2. 重新整理頁面再試一次

## ✅ 測試通過標準

**所有以下項目都必須通過**:

- [x] 從首頁可以進入觀戰大廳
- [x] 可以配置4個AI
- [x] 點擊"開始觀戰"成功創建房間
- [x] AI自動輪流出牌，無需人工干預
- [x] 遊戲流程正確（抽牌→配對→宣告→下一位）
- [x] 速度控制有效
- [x] 暫停/繼續功能正常
- [x] 遊戲能夠自然進行到結束
- [x] 正確判斷勝利者
- [x] 顯示最終結果
- [x] 重新開始功能正常
- [x] Console無嚴重錯誤
- [x] UI響應流暢，無明顯卡頓
- [x] 多局測試穩定

## 📊 測試報告模板

```
## 觀戰模式測試報告
測試日期: YYYY-MM-DD
測試人員: [姓名]

### 基本功能測試
- [ ] 進入觀戰大廳: ✅ / ❌
- [ ] AI配置: ✅ / ❌
- [ ] 開始觀戰: ✅ / ❌
- [ ] AI自動對戰: ✅ / ❌
- [ ] 速度控制: ✅ / ❌
- [ ] 暫停/繼續: ✅ / ❌
- [ ] 遊戲結束: ✅ / ❌
- [ ] 重新開始: ✅ / ❌

### 完整對戰測試
對戰1: [勝利者] - 耗時: [X分鐘] - 結果: ✅ / ❌
對戰2: [勝利者] - 耗時: [X分鐘] - 結果: ✅ / ❌
對戰3: [勝利者] - 耗時: [X分鐘] - 結果: ✅ / ❌

### Console錯誤
- [ ] 無錯誤
- [ ] 有錯誤（請列出）:

### 問題記錄
1. [問題描述]
2. [問題描述]

### 總體評價
- 穩定性: ★★★★★ (1-5星)
- 流暢度: ★★★★★ (1-5星)
- 易用性: ★★★★★ (1-5星)

### 結論
✅ 通過測試 / ❌ 需要修復
```

## 🎯 下一步

測試通過後，可以考慮以下增強功能：
1. 顯示AI思考過程（決策理由）
2. 遊戲統計（勝率、平均分數）
3. 回放功能
4. 多個觀戰者同時觀看
5. 導出對戰數據用於AI訓練

---

**祝測試順利！** 🎮✨
