# ğŸ§ª E2E æ¸¬è©¦æŒ‡å— - AI å°æˆ°å®Œæ•´æµç¨‹

## ğŸ“‹ æ¦‚è¿°

æœ¬å°ˆæ¡ˆåŒ…å«å®Œæ•´çš„ç«¯åˆ°ç«¯ï¼ˆE2Eï¼‰æ¸¬è©¦ï¼Œç”¨æ–¼è‡ªå‹•åŒ–æ¸¬è©¦ AI ç©å®¶å°æˆ°çš„å®Œæ•´éŠæˆ²æµç¨‹ï¼Œä¸¦åœ¨é—œéµæ™‚åˆ»è‡ªå‹•æˆªåœ–ã€‚

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### å‰ç½®è¦æ±‚

1. **Node.js**: v22.12.0 æˆ–æ›´æ–°ç‰ˆæœ¬
2. **Playwright**: å·²å®‰è£ï¼ˆé€é npmï¼‰
3. **é–‹ç™¼ä¼ºæœå™¨**: å¿…é ˆé‹è¡Œåœ¨ `http://localhost:5173`

### å®‰è£ä¾è³´

```bash
# å®‰è£ Playwright å’Œç›¸é—œä¾è³´
npm install

# å®‰è£ Playwright ç€è¦½å™¨ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰
npx playwright install chromium
```

---

## ğŸ® åŸ·è¡Œæ¸¬è©¦

### æ–¹æ³• 1: åŸºæœ¬æ¸¬è©¦ï¼ˆæ¨è–¦ï¼‰

```bash
# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨ï¼ˆæ–°çµ‚ç«¯ï¼‰
npm run dev

# åŸ·è¡Œæ‰€æœ‰ E2E æ¸¬è©¦ï¼ˆå¦ä¸€å€‹çµ‚ç«¯ï¼‰
npm run test:e2e
```

### æ–¹æ³• 2: æœ‰é ­æ¨¡å¼ï¼ˆå¯è¦–åŒ–ï¼‰

æŸ¥çœ‹ç€è¦½å™¨å¯¦éš›æ“ä½œéç¨‹ï¼š

```bash
# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
npm run dev

# ä»¥æœ‰é ­æ¨¡å¼åŸ·è¡Œæ¸¬è©¦
npx playwright test e2e/ai-full-game.spec.js --headed
```

### æ–¹æ³• 3: UI æ¨¡å¼ï¼ˆé™¤éŒ¯ï¼‰

ä½¿ç”¨ Playwright UI ä»‹é¢é€²è¡Œé™¤éŒ¯ï¼š

```bash
# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
npm run dev

# é–‹å•Ÿ UI æ¨¡å¼
npm run test:e2e:ui
```

### æ–¹æ³• 4: åªåŸ·è¡Œç‰¹å®šæ¸¬è©¦

```bash
# åªåŸ·è¡Œå®Œæ•´ AI å°æˆ°æ¸¬è©¦
npx playwright test e2e/ai-full-game.spec.js -g "4 ä½ç©å®¶å°æˆ°ç›´åˆ°éŠæˆ²çµæŸ"

# åªåŸ·è¡Œ AI æ±ºç­–æ¸¬è©¦
npx playwright test e2e/ai-full-game.spec.js -g "æª¢æŸ¥ AI å®£å‘Šæ±ºç­–"
```

---

## ğŸ“¸ æˆªåœ–èªªæ˜

### è‡ªå‹•æˆªåœ–æ™‚æ©Ÿ

æ¸¬è©¦æœƒåœ¨ä»¥ä¸‹æ™‚åˆ»è‡ªå‹•æˆªåœ–ï¼š

| æ™‚æ©Ÿ | æª”æ¡ˆåç¨±æ ¼å¼ | èªªæ˜ |
|------|------------|------|
| æˆ¿é–“å‰µå»º | `001_01-room-created_*.png` | æˆ¿é–“å‰µå»ºæˆåŠŸï¼Œé¡¯ç¤ºæˆ¿é–“ä»£ç¢¼ |
| ç©å®¶å°±ç·’ | `002_02-all-players-ready_*.png` | æ‰€æœ‰ç©å®¶ï¼ˆ1äºº+3AIï¼‰å·²åŠ å…¥ |
| éŠæˆ²é–‹å§‹ | `003_03-game-started_*.png` | éŠæˆ²åˆå§‹åŒ–ï¼Œç‰Œé¢å°±ç·’ |
| Stop å®£å‘Š | `004_04-declare-stop_*.png` | AI ç©å®¶å®£å‘Šã€Œåˆ°æ­¤ç‚ºæ­¢ã€ |
| Last Chance å®£å‘Š | `005_05-declare-lastchance_*.png` | AI ç©å®¶å®£å‘Šã€Œæœ€å¾Œæ©Ÿæœƒã€ |
| å›åˆçµç®— | `006_06-round{N}-end_*.png` | ç¬¬ N å›åˆçµæŸä¸¦è¨ˆåˆ† |
| å·ç‰Œæ•ˆæœ | `special-steal-card_*.png` | Shark+Swimmer é…å°å·ç‰Œ |
| éŠæˆ²çµæŸ | `099_99-game-over-final_*.png` | æœ€çµ‚è´å®¶å®£å¸ƒ |
| é€²åº¦è¨˜éŒ„ | `progress-{N}_*.png` | æ¯ 10 ç§’è‡ªå‹•è¨˜éŒ„ä¸€æ¬¡ |

### æˆªåœ–å„²å­˜ä½ç½®

```
test-screenshots/
â””â”€â”€ ai-battle/
    â”œâ”€â”€ 001_01-room-created_2025-12-24T03-00-00-000Z.png
    â”œâ”€â”€ 002_02-all-players-ready_2025-12-24T03-00-05-000Z.png
    â”œâ”€â”€ 003_03-game-started_2025-12-24T03-00-10-000Z.png
    â””â”€â”€ ...
```

---

## ğŸ” æ¸¬è©¦å…§å®¹è©³è§£

### æ¸¬è©¦ 1: å®Œæ•´ AI å°æˆ°æµç¨‹

**æ¸¬è©¦ç›®æ¨™**: é©—è­‰éŠæˆ²å¾é–‹å§‹åˆ°çµæŸçš„å®Œæ•´æµç¨‹

**æ¸¬è©¦æ­¥é©Ÿ**:
1. é€²å…¥é¦–é 
2. å‰µå»ºæˆ¿é–“
3. æ·»åŠ  3 å€‹ AI ç©å®¶ï¼ˆå°ç™½ã€å°é»‘ã€å°ç´…ï¼‰
4. é–‹å§‹éŠæˆ²
5. ç›£æ§éŠæˆ²é€²è¡Œï¼ˆæœ€å¤š 10 åˆ†é˜ï¼‰
6. æ•æ‰é—œéµæ™‚åˆ»æˆªåœ–
7. ç­‰å¾…éŠæˆ²çµæŸ
8. é©—è­‰éŠæˆ²æ­£å¸¸å®Œæˆ

**é©—è­‰é …ç›®**:
- âœ… è‡³å°‘å®Œæˆ 1 å€‹å›åˆ
- âœ… è‡³å°‘æ•æ‰ 5 å¼µæˆªåœ–
- âœ… éŠæˆ²èƒ½æ­£å¸¸çµæŸ

### æ¸¬è©¦ 2: AI æ±ºç­–æ¸¬è©¦

**æ¸¬è©¦ç›®æ¨™**: é©—è­‰ AI å®£å‘Šæ±ºç­–é‚è¼¯

**æ¸¬è©¦æ­¥é©Ÿ**:
1. å‰µå»ºæˆ¿é–“ä¸¦æ·»åŠ  3 AI
2. é–‹å§‹éŠæˆ²
3. ç›£è½ AI å®£å‘Šäº‹ä»¶
4. ç­‰å¾…è‡³å°‘ä¸€æ¬¡å®£å‘Šï¼ˆæœ€å¤š 3 åˆ†é˜ï¼‰
5. çµ±è¨ˆå®£å‘Šé¡å‹

**é©—è­‰é …ç›®**:
- âœ… AI èƒ½å¤ åšå‡ºå®£å‘Šæ±ºç­–
- âœ… è¨˜éŒ„å®£å‘Šé¡å‹ï¼ˆStop/Last Chanceï¼‰

---

## ğŸ“Š æŸ¥çœ‹æ¸¬è©¦å ±å‘Š

### HTML å ±å‘Š

æ¸¬è©¦å®Œæˆå¾Œè‡ªå‹•ç”Ÿæˆ HTML å ±å‘Šï¼š

```bash
# æŸ¥çœ‹æ¸¬è©¦å ±å‘Š
npm run test:e2e:report
```

### Console è¼¸å‡º

æ¸¬è©¦éç¨‹ä¸­æœƒè¼¸å‡ºè©³ç´°æ—¥èªŒï¼š

```
ğŸ® é–‹å§‹ AI å°æˆ°æ¸¬è©¦...
âœ… è¼‰å…¥é¦–é 
âœ… å‰µå»ºæˆ¿é–“
ğŸ“ æˆ¿é–“ä»£ç¢¼: ABCDEF
ğŸ¤– æ·»åŠ  AI ç©å®¶...
  âœ… AI å°ç™½
  âœ… AI å°é»‘
  âœ… AI å°ç´…
âœ… éŠæˆ²é–‹å§‹
ğŸ‘€ ç›£æ§éŠæˆ²é€²è¡Œ...
ğŸ“¸ Screenshot: 01-room-created
ğŸ“¸ Screenshot: 02-all-players-ready
ğŸ“¸ Screenshot: 03-game-started
ğŸ¯ æ•ç²å®£å‘Š STOP
ğŸ“¸ Screenshot: 04-declare-stop
ğŸ“Š å›åˆ 1 çµæŸ
ğŸ“¸ Screenshot: 06-round1-end
  â±ï¸ é€²è¡Œä¸­... (30ç§’)
ğŸ† éŠæˆ²çµæŸï¼
ğŸ“¸ Screenshot: 99-game-over-final

ğŸ“‹ æ¸¬è©¦ç¸½çµ:
  ç¸½æˆªåœ–æ•¸: 15
  å›åˆæ•¸: 3
  éŠæˆ²æ™‚é•·: 245 ç§’
```

---

## ğŸ› å¸¸è¦‹å•é¡Œæ’é™¤

### å•é¡Œ 1: æ¸¬è©¦å¤±æ•— - "æµ·é¹½èˆ‡ç´™ç‰Œ" æ–‡å­—æœªæ‰¾åˆ°

**åŸå› **: é–‹ç™¼ä¼ºæœå™¨é‹è¡Œåœ¨éŒ¯èª¤çš„å°ˆæ¡ˆ

**è§£æ±ºæ–¹æ³•**:
```bash
# ç¢ºèªç•¶å‰ç›®éŒ„
pwd  # æ‡‰è©²åœ¨ board-game-sea-salt-paper/

# åœæ­¢æ‰€æœ‰é–‹ç™¼ä¼ºæœå™¨
# Windows:
netstat -ano | findstr ":5173"
powershell "Stop-Process -Id [PID] -Force"

# é‡æ–°å•Ÿå‹•
npm run dev
```

### å•é¡Œ 2: æˆªåœ–ç›®éŒ„ä¸å­˜åœ¨

**è§£æ±ºæ–¹æ³•**:
```bash
# å‰µå»ºæˆªåœ–ç›®éŒ„
mkdir -p test-screenshots/ai-battle
```

### å•é¡Œ 3: æ¸¬è©¦è¶…æ™‚

**åŸå› **: éŠæˆ²é€²è¡Œæ™‚é–“éé•·æˆ–å¡ä½

**è§£æ±ºæ–¹æ³•**:
- æª¢æŸ¥ console æ˜¯å¦æœ‰éŒ¯èª¤
- ä½¿ç”¨æœ‰é ­æ¨¡å¼è§€å¯ŸéŠæˆ²ç‹€æ…‹ï¼š
  ```bash
  npx playwright test e2e/ai-full-game.spec.js --headed
  ```

### å•é¡Œ 4: Playwright æœªå®‰è£

**è§£æ±ºæ–¹æ³•**:
```bash
npx playwright install chromium
```

---

## âš™ï¸ æ¸¬è©¦é…ç½®

### playwright.config.js é‡è¦è¨­å®š

```javascript
{
  testDir: './e2e',                // æ¸¬è©¦æª”æ¡ˆç›®éŒ„
  timeout: 600000,                 // å–®ä¸€æ¸¬è©¦è¶…æ™‚ï¼ˆ10åˆ†é˜ï¼‰
  workers: 1,                      // ä½¿ç”¨ 1 å€‹ workerï¼ˆé¿å…ä¸¦ç™¼ï¼‰
  baseURL: 'http://localhost:5173', // é–‹ç™¼ä¼ºæœå™¨ URL
  screenshot: 'only-on-failure',   // å¤±æ•—æ™‚è‡ªå‹•æˆªåœ–
  video: 'retain-on-failure',      // å¤±æ•—æ™‚ä¿ç•™éŒ„å½±
}
```

### è‡ªè¨‚è¶…æ™‚è¨­å®š

å¦‚æœéŠæˆ²æ™‚é–“è¼ƒé•·ï¼Œå¯ä»¥èª¿æ•´æ¸¬è©¦è¶…æ™‚ï¼š

```javascript
test('é•·æ™‚é–“æ¸¬è©¦', async ({ page }) => {
  test.setTimeout(900000) // 15 åˆ†é˜
  // ...
})
```

---

## ğŸ“– å»¶ä¼¸é–±è®€

### ç›¸é—œæ–‡ä»¶

- **éŠæˆ²æµç¨‹åœ–**: `GAME_FLOW_DIAGRAM.md`
- **æ¸¬è©¦å ±å‘Š**: `AI_BATTLE_TEST_REPORT.md`
- **å°ˆæ¡ˆè¦åŠƒ**: `PLANNING.md`

### Playwright å®˜æ–¹æ–‡ä»¶

- [Playwright å®˜ç¶²](https://playwright.dev/)
- [æ¸¬è©¦æœ€ä½³å¯¦è¸](https://playwright.dev/docs/best-practices)
- [é™¤éŒ¯æŒ‡å—](https://playwright.dev/docs/debug)

---

## ğŸ¯ æ¸¬è©¦æœ€ä½³å¯¦è¸

### 1. æ¸¬è©¦å‰æª¢æŸ¥æ¸…å–®

- [ ] é–‹ç™¼ä¼ºæœå™¨æ­£åœ¨é‹è¡Œ
- [ ] ç„¡å…¶ä»–æ¸¬è©¦åŒæ™‚åŸ·è¡Œ
- [ ] æˆªåœ–ç›®éŒ„å·²å‰µå»º
- [ ] Playwright ç€è¦½å™¨å·²å®‰è£

### 2. åŸ·è¡Œæ¸¬è©¦çš„æ™‚æ©Ÿ

- âœ… æ–°åŠŸèƒ½é–‹ç™¼å®Œæˆå¾Œ
- âœ… ä¿®å¾© Bug å¾Œé©—è­‰
- âœ… éƒ¨ç½²å‰æœ€çµ‚æª¢æŸ¥
- âœ… CI/CD pipeline ä¸­è‡ªå‹•åŸ·è¡Œ

### 3. æ¸¬è©¦å¤±æ•—æ™‚

1. æŸ¥çœ‹å¤±æ•—æˆªåœ–ï¼š`test-results/` ç›®éŒ„
2. æŸ¥çœ‹éŒ„å½±æª”æ¡ˆï¼š`test-results/` ç›®éŒ„
3. ä½¿ç”¨ UI æ¨¡å¼é‡è·‘æ¸¬è©¦
4. æª¢æŸ¥ console æ—¥èªŒ

---

## ğŸ“ ç¯„ä¾‹è…³æœ¬

### ä¸€éµåŸ·è¡Œæ¸¬è©¦

å‰µå»º `run-ai-test.sh` (Linux/Mac) æˆ– `run-ai-test.bat` (Windows):

**Windows (run-ai-test.bat)**:
```batch
@echo off
echo ğŸ® å•Ÿå‹• AI å°æˆ°æ¸¬è©¦...

REM å‰µå»ºæˆªåœ–ç›®éŒ„
if not exist "test-screenshots\ai-battle" mkdir test-screenshots\ai-battle

REM å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨ï¼ˆèƒŒæ™¯ï¼‰
start /B npm run dev

REM ç­‰å¾…ä¼ºæœå™¨å•Ÿå‹•
timeout /t 10 /nobreak

REM åŸ·è¡Œæ¸¬è©¦
npx playwright test e2e/ai-full-game.spec.js

REM é¡¯ç¤ºå ±å‘Š
npx playwright show-report

echo âœ… æ¸¬è©¦å®Œæˆï¼
pause
```

**Linux/Mac (run-ai-test.sh)**:
```bash
#!/bin/bash
echo "ğŸ® å•Ÿå‹• AI å°æˆ°æ¸¬è©¦..."

# å‰µå»ºæˆªåœ–ç›®éŒ„
mkdir -p test-screenshots/ai-battle

# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨ï¼ˆèƒŒæ™¯ï¼‰
npm run dev &
DEV_SERVER_PID=$!

# ç­‰å¾…ä¼ºæœå™¨å•Ÿå‹•
sleep 10

# åŸ·è¡Œæ¸¬è©¦
npx playwright test e2e/ai-full-game.spec.js

# é¡¯ç¤ºå ±å‘Š
npx playwright show-report

# é—œé–‰é–‹ç™¼ä¼ºæœå™¨
kill $DEV_SERVER_PID

echo "âœ… æ¸¬è©¦å®Œæˆï¼"
```

---

**æ–‡ä»¶ç‰ˆæœ¬**: 1.0
**æœ€å¾Œæ›´æ–°**: 2025-12-24
**ç¶­è­·è€…**: Development Team
